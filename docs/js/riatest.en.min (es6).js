'use strict';class f{constructor(a="div",b=""){this.b=document.createElement(a);this.b.className=b;this.l=[];this.title=""}$(a){this.l.push(a)}display(a){this.refresh();for(let a of this.l)a.refresh();a.appendChild(this.b)}C(a,b=this.b){a.display(b);this.$(a)}X(a){const b=this.l;for(let c=0,d=b.length;c<d;c++){const d=b[c];d===a&&(b.splice(c,1),d.remove())}}remove(){const a=this.b.parentNode;a?a.removeChild(this.b):console.warn("Couldn't remove view because it has no parentNode:",this.b);this.m();for(let a of this.l)a.m()}querySelector(a){return this.b.querySelector(a)}querySelectorAll(a){return this.b.querySelectorAll(a)}refresh(){const a=
this.c();if(a){this.b.innerHTML=a;for(let a of this.l)a.m();this.l=[]}this.i()}c(){}i(){}m(){}};const g=Symbol("fields");
class h{constructor(a){this.v={};this.A={};this.M();a&&this.load(a)}get(a,b,c){a=this.v[a];void 0!==b&&(a=a?b in a?a[b]:c:void 0);return a}set(a,b,c){var d=this.constructor[g][a];if(!d)throw Error("Unknown field "+a);d.H(b,a,c);void 0!==c?this.v[a][c]=b:this.v[a]=b;this.fa(a,b);return b}append(a,b){this.set(a,b,this.v[a].length)}fa(a,b){const c=this.A[a];for(var d=0,e=c.length;d<e;d++){const e=c[d];e[1].call(e[0],b,a,this)}}R(a){const b=this.A[a];if(!b)throw Error("Unknown field: "+a);return b}observe(a,
b,c){this.R(a).push([b,c])}unobserve(a,b,c){const d=this.R(a);this.A[a]=d.filter((a)=>!(a[0]===b&&(!c||a[1]==c)))}M(){var a=this.constructor[g],b;for(b in a){var c=a[b];this.A[b]=[];this.set(b,c.M())}}load(a){for(var b in a){var c=this.constructor[g][b];if(c)try{this.set(b,c.parse(a[b],b))}catch(d){throw console.error(`Error loading field ${b}: ${d}`),d;}else console.error("Unknown field: ",this.constructor.name,b)}}D(){var a=this.v,b=this.constructor[g],c={},d;for(d in a)c[d]=b[d].L(a[d]);return c}}
;class l extends Error{constructor(a){super(a);this.name="ValidationError";this.message=a;this.stack||(this.stack=Error(a).stack)}};function p(a,b,c){if(!c)throw new l(a+": "+b);};const q={min:function(a,b,c){p(c,`value ${b} isn't over ${a}`,b>=a)},max:function(a,b,c){p(c,`value ${b} isn't under ${a}`,b<=a)},ra:function(a,b,c){p(c,`value ${b} isn't an integer`,!a||0==b%1)},T:function(a,b,c){p(c,`value ${b} isn't in ${a}`,-1!==a.indexOf(b))},sa:function(a,b,c){0==a&&p(c,"value can't be null or undefined",null!==b&&void 0!==b)}};
class t{constructor(a,b){var c=typeof a;p("type","Type is not a valid type: "+c,"string"==c||"function"==c);this.type=a;this.K=b||{}}H(a,b){this.S(a,b)}S(a,b){if(void 0===a)debugger;var c=this.type,d=typeof c,e=this.K;switch(d){case "string":p(b,"Value is not a "+c,typeof a===c);break;case "function":p(b,"Value is not a "+c.name,null===a||a instanceof c);break;default:throw Error("Unsupported type of type: "+d);}for(var k in e)if(k in q)q[k](e[k],a,b)}L(a){return"function"==typeof this.type?a?a.D():
null:a}parse(a,b){var c=this.type,d=typeof c;switch(d){case "string":return this.S(a,b),a;case "function":return a?c.fromJSON?c.fromJSON(a):new c(a):null;default:throw Error("Unknown value type: "+d);}}M(){var a=this.type,b=this.K;if(void 0!==b.default)return b.default;if(b.T)return b.T[0];if("string"==typeof a){b={number:0,string:"","boolean":!1};if(!(a in b))throw Error("Unknown type: "+a);return b[a]}return new a}};const u={na:function(a,b,c){b=b.length;p(c,"Array length "+b+" is under "+a,b>=a)},ma:function(a,b,c){b=b.length;p(c,"Array length "+b+" is over "+a,b<=a)},count:function(a,b,c){this.na(a,b,c);this.ma(a,b,c)}};
class v extends t{constructor(a,b){b||(b=[]);b.default||(b.default=[]);super(a,b)}H(a,b,c){if(void 0!==c)p(b,"Key must be an integer","number"==typeof c&&0===c%1),super.H(a,b+"["+c+"]");else{p(b,"Value must be an array",a instanceof Array);c=this.K;for(var d in c)if(d in u)u[d](c[d],a,b);d=0;for(c=a.length;d<c;d++)super.H(a[d],b+"["+d+"]")}}L(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=super.L(a[c]);return b}parse(a,b){var c=[];p(b,"value is not an array",a instanceof Array);for(var d=0,e=a.length;d<
e;d++)c[d]=super.parse(a[d],b);return c}};function w(a,b){if(a.hasOwnProperty(g))var c=a[g];else c=(a.ta||Object.getPrototypeOf(a.prototype)).constructor,c=Object.create(c[g]||{}),a[g]=c;a=c;for(var d in b)a[d]=b[d]}
function x(a,b){function c(a){return function(){return this.get(a)}}function d(a){return function(b){return this.set(a,b)}}if(!(a.prototype instanceof h))throw new TypeError("Not a Model: "+a.name);var e={},k={},r;for(r in b){var m=b[r],n=m[0];m=m[1];if(!n)throw new TypeError("Field name is missing");if(!m)throw new TypeError("Field definition is missing");e[n]=m;k[r]={enumerable:!0,configurable:!0,get:c(n),set:d(n)}}w(a,e);Object.defineProperties(a.prototype,k)};class y extends h{constructor(a){super(a)}}x(y,{o:["question",new t("string",void 0)],s:["answer",new t("string",void 0)],g:["incorrectAnswers",new v("string",void 0)]});class z extends h{constructor(a){super(a)}}x(z,{h:["questions",new v(y,void 0)]});class A extends f{constructor(a){super("section","page homepage");this.a=a}c(){return`\n            <header>\n                <h3>Practice Test Taker</h3>\n            </header>\n            <main>\n                <p><a class="button button-take-test${this.a.h.length?"":" disabled"}" href="#taketest/5">Take Sample Test</a> ( <input type="number" class="num-questions" value="5"> Questions)</p>\n                <p><a class="button" href="#edit">Edit Test Bank</a></p>\n            </main>\n        `}i(){const a=
this.querySelector("input.num-questions"),b=this.querySelector("a.button-take-test");a.addEventListener("input",()=>{b.href=`#taketest/${a.value}`})}};let B=1;function C(a){const b=[];for(let c=0,d=a.length;c<d;c++)b.splice(Math.floor(Math.random()*(c+1)),0,a[c]);return b};class D extends f{constructor(a){super("section","page take-test");this.h=a;this.O=[]}c(){return'\n            <header><h2>Questions</h2></header>\n            <main class="test-questions"></main>\n            <footer>\n                <a class="button button-grade-test">Grade Test</a>\n                <span class="test-results"></span>\n            </footer>\n        '}i(){this.O=[];const a=this.querySelector("main.test-questions");let b=0;for(let c of this.h){const d=new E(c,b++);this.C(d,a);this.O.push(d)}this.querySelector("a.button.button-grade-test").addEventListener("click",
this.ia.bind(this))}ia(){let a=0;const b=this.h.length;for(let b of this.O)a+=b.ha()?1:0;this.querySelector(".test-results").textContent=`${a} correct out of ${b} (${Math.round(100*a/b)}%)`}}
class E extends f{constructor(a,b){super("section","question");this.a=a;this.index=b}c(){const a=this.a,b=C(a.g.concat([a.s])),c=`question-${this.index}`;let d=0,e;return`\n            <h3 class="question ${c}">${this.index+1}. ${a.o}</h3>\n            <ol class="answers" type="A">\n                ${b.map((a)=>(e=`${c}-answer-${++d}`,`\n                        <li>\n                            <input type="radio" name="${c}" value="${a}" id="${e}"\n                            ><label for="${e}">${a}</label>\n                        </li>\n                    `)).join("")}\n            </ol>\n        `}ha(){for(var a of this.querySelectorAll("li"))a.classList.remove("incorrect",
"correct");const b=(a=this.querySelector("input:checked"))&&a.value===this.a.s;a&&a.parentNode.classList.add(b?"correct":"incorrect");return b}};class F extends f{constructor(a){super("section","page edit-question");this.a=a;a=a.o;20<a.length&&(a=a.substr("17\u2026"));this.title="Edit Question: "+a;this.N=0;this.G=null}c(){return`\n            <div class="field question">\n                <label for="question-${B++}">Question:</label>\n                <textarea id="question-${B}"></textarea>\n            </div>\n            <div class="field correct-answer">\n                <label for="answer-${B++}">Correct Answer:</label>\n                <input id="answer-${B}" type="text">\n            </div>\n            <div class="incorrect-answers"></div>\n            <div class="actions"><a class="button save">Done</a></div>\n        `}i(){const a=
this.a,b=this.querySelector(".question textarea"),c=this.querySelector(".correct-answer input"),d=this.querySelector(".button.save");a.g=a.g.filter(Boolean);b.value=a.o||"";c.value=a.s||"";b.addEventListener("input",()=>{a.o=b.value});c.addEventListener("input",()=>{a.s=c.value});d.addEventListener("click",()=>{this.G&&this.G.call(null)});this.ja=this.b.querySelector(".incorrect-answers");this.N=0;for(let b of a.g)this.J(b);this.J()}m(){const a=this.a;a.g=a.g.filter(Boolean)}J(a=""){const b=this.a,
c=document.createElement("div");c.className="field incorrect-answer";c.innerHTML=`\n            <label for="answer-${B++}">Incorrect Answer:</label>\n            <input id="answer-${B}" type="text">\n        `;const d=this.N++,e=c.querySelector("input");a&&(e.value=a);e.addEventListener("input",()=>{(b.g[d]=e.value)&&d==this.N-1&&!b.g.some((a)=>!a)&&this.J()});this.ja.appendChild(c)}};class G extends f{constructor(a=""){super("div",`modal-dialog${a&&" "+a}`);this.onclose=null;console.log("ModalView...")}Y(a){return`<section>${a}</section>`}close(){console.log("ModalView.close",this.onclose);this.onclose&&this.onclose.call(null)}};class H extends G{constructor(a){super();this.a=a;this.F=null}c(){return super.Y('\n            <header>\n                <h3>Select file to import:</h3>\n            </header>\n            <main>\n                <div><input type="file" name="import" accept=".json"></div>\n                <p><em>This will replace all loaded questions with the one from the backup file.</em></p>\n                <div class="alert error hidden"></div>\n            </main>\n            <footer>\n                <a class="button cancel-button">Cancel</a>\n                <a class="button load-button disabled">Import</a>\n            </footer>\n        ')}i(){const a=
this.querySelector("input[type=file]"),b=this.querySelector("a.button.load-button");this.querySelector("a.button.cancel-button").addEventListener("click",this.close.bind(this));a.addEventListener("change",this.ga.bind(this),!1);b.addEventListener("click",()=>{this.F&&(this.a.set("questions",this.F.get("questions")),this.close())})}ga(a){a.preventDefault();a.stopPropagation();this.F=null;const b=a.target.files[0],c=this.querySelector("div.alert.error"),d=this.querySelector("a.button.load-button");
d.classList.add("disabled");c.classList.add("hidden");c.textContent="";if(b){const a=new FileReader;a.onload=()=>{try{const b=JSON.parse(a.result),c=new z(b);c.h.length&&(this.F=c,d.classList.remove("disabled"))}catch(k){c.textContent="Couldn't read file "+b.name,c.classList.remove("hidden")}};a.onerror=()=>{c.textContent="An error happened loading the file";c.classList.remove("hidden")};a.readAsText(b)}}};class I extends G{constructor(a){super();this.a=a}c(){return super.Y('\n            <header>\n                <h3>Export Questions</h3>\n            </header>\n            <main>\n                <div><label for="file_name_input">File Name:</label><input type="text" id="file_name_input" value="Questions.json"></div>\n            </main>\n            <footer>\n                <a class="button cancel-button">Cancel</a>\n                <a class="button save-button disabled">Save</a>\n            </footer>\n        ')}i(){function a(){const a=
b.value;c.setAttribute("download",a);c.classList.toggle("disabled",!a)}const b=this.querySelector("input#file_name_input"),c=this.querySelector("a.button.save-button");this.querySelector("a.button.cancel-button").addEventListener("click",this.close.bind(this));const d=JSON.stringify(this.a.D(),null,2);c.href="data:text/plain;charset=utf-8,"+encodeURIComponent(d);c.classList.remove("disabled");a();b.addEventListener("input",a)}};class J extends f{constructor(a){super("section","page edit-test-bank");this.a=a;this.W=0;this.title="Edit Questions";console.log("Constructed EditTestBankView: ",this)}c(){return'\n            <header class="toolbar">\n                <h3>All Questions</h3>\n                <div class="actions">\n                    <a class="action add-action" href="#edit/new">Add</a>\n                    <a class="action save-action disabled" download="Questions.json">Save Backup</a>\n                    <a class="action load-action">Import Backup</a>\n                </div>\n            </header>\n            <main>\n                <table class="edit-questions">\n                    <thead>\n                        <th></th>\n                        <th class="question">Question</th>\n                        <th class="answer">Correct Answer</th>\n                        <th class="incorrect-answers">Incorrect Answers</th>\n                        <th></th>\n                    </thead>\n                    <tbody></tbody>\n                </table>\n            </main>\n        '}i(){this.w();
this.W=0;const a=this.querySelector("table.edit-questions > tbody"),b=this.querySelector(".actions a.save-action"),c=this.querySelector(".actions a.load-action"),d=this.a;for(let b of d.h){const c=new K(b,this.W++);this.C(c,a)}JSON.stringify(d.D(),null,2);b.classList.toggle("disabled",!d.h.length);b.addEventListener("click",this.pa.bind(this));c.addEventListener("click",this.ka.bind(this));d.observe("questions",this,()=>{this.refresh()})}m(){this.w()}w(){this.a.unobserve("questions",this)}pa(){const a=
new I(this.a);this.C(a);a.onclose=()=>{this.X(a)}}ka(){const a=new H(this.a);this.C(a);a.onclose=()=>{this.X(a)}}}
class K extends f{constructor(a,b){super("tr","question");this.a=a;this.index=b;console.log("Constructed EditTestBankQuestionRow: ",b)}c(){const a=this.index+1;return`\n            <th class="number">${a}</th>\n            <td class="question"></td>\n            <td class="answer"></td>\n            <td class="incorrect-answers"></td>\n            <td class="edit"><a class="button" href="#edit/${a}">Edit</a></td>\n        `}i(){const a=this.a;this.w();const b=this.querySelector("td.question"),c=this.querySelector("td.answer"),
d=this.querySelector("td.incorrect-answers"),e=(a)=>{d.innerHTML="";for(let b=0,c=a.length;b<c;b++){const e=document.createElement("div");e.textContent=a[b];b<c-1&&(e.textContent+=",");d.appendChild(e)}};b.textContent=a.o;c.textContent=a.s;e(a.g);a.observe("question",this,(a)=>{b.textContent=a});a.observe("answer",this,(a)=>{c.textContent=a});a.observe("incorrectAnswers",this,e)}m(){this.w()}w(){const a=this.a;a.unobserve("question",this);a.unobserve("answer",this);a.unobserve("incorrectAnswers",
this)}};class L{constructor(a){this.Z=a;this.I=()=>{this.ea()}}start(){window.addEventListener("hashchange",this.I);this.I()}stop(){window.removeEventListener("hashchange",this.I)}ea(){var a=location.hash.substr(1);let b;for(let c of this.Z)if(b=c.pattern.exec(a)){c.j.apply(null,b);return}console.log("Unable to find handler for route "+a,this.Z)}};class M extends f{constructor(){super("div","app");this.f=this.B=null;this.oa=new L([{pattern:/^$/,j:this.ca.bind(this)},{pattern:/^taketest$/,j:this.V.bind(this)},{pattern:/^taketest\/(\d+)$/,j:this.V.bind(this)},{pattern:/^edit$/,j:this.aa.bind(this)},{pattern:/^edit\/(\d+)$/,j:this.ba.bind(this)},{pattern:/^edit\/new$/,j:this.da.bind(this)},{pattern:/.*/,j:this.U.bind(this)}])}qa(){this.la();this.display(document.body);this.oa.start()}c(){return""}u(a,b){this.B&&(this.B.remove(),this.B=null);a=
new a(b);a.display(this.b);this.B=a;document.title=a.title||"Test Taker";return a}ca(){this.u(A,this.f)}V(a,b){console.log("displayTakeTestPage: ",b);b=parseInt(b,10)||5;a=C(this.f.h).slice(0,b);this.u(D,a)}aa(){console.log("displayEditbankRoute");this.u(J,this.f)}P(){localStorage.setItem("questionStore",JSON.stringify(this.f.D()))}la(){this.f&&this.f.unobserve("questions",this);const a=new z,b=localStorage.getItem("questionStore");if(b)try{a.load(JSON.parse(b))}catch(c){console.error("Unable to parse save data: ",
c)}a.observe("questions",this,()=>{console.log("Application: observed update to questions field");this.P()});this.f=a}ba(a,b){(b=this.f.h[parseInt(b,10)-1])?this.u(F,b).G=()=>{this.P();location.hash="#edit"}:this.U(a)}da(){const a=new y;this.u(F,a).G=()=>{a.o&&this.f.append("questions",a);this.P();location.hash="#edit"}}U(a){console.log("Will display 404: ",a)}};var N=new M;console.log("Starting app");N.qa();
