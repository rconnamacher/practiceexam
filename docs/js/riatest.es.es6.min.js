/*Practice Test 0.0.5, (c) 2018 Richard Connamacher. All Rights Reserved.*/ (function(){'use strict';class f{constructor(a="div",b=""){this.c=document.createElement(a);this.c.className=b;this.m=[];this.title=""}ba(a){this.m.push(a)}display(a){this.refresh();for(let a of this.m)a.refresh();a.appendChild(this.c)}v(a,b=this.c){a.display(b);this.ba(a)}Z(a){const b=this.m;for(let c=0,d=b.length;c<d;c++){const d=b[c];d===a&&(b.splice(c,1),d.remove())}}remove(){const a=this.c.parentNode;a?a.removeChild(this.c):console.warn("Couldn't remove view because it has no parentNode:",this.c);this.o();for(let a of this.m)a.o()}querySelector(a){return this.c.querySelector(a)}a(a){const b=
this.c.querySelector(a);if(!b)throw Error(`Required selector ${a} not found`);return b}querySelectorAll(a){return this.c.querySelectorAll(a)}refresh(){const a=this.f();if(a){this.c.innerHTML=a;for(let a of this.m)a.o();this.m=[]}this.i()}f(){}i(){}o(){}};const h=Symbol("fields");
class k{constructor(a){this.A={};this.C={};this.O();a&&this.load(a)}get(a,b,c){a=this.A[a];void 0!==b&&(a=a?b in a?a[b]:c:void 0);return a}set(a,b,c){var d=this.constructor[h][a];if(!d)throw Error("Unknown field "+a);d.J(b,a,c);void 0!==c?this.A[a][c]=b:this.A[a]=b;this.ia(a,b);return b}append(a,b){this.set(a,b,this.A[a].length)}ia(a,b){const c=this.C[a];for(var d=0,e=c.length;d<e;d++){const e=c[d];e[1].call(e[0],b,a,this)}}T(a){const b=this.C[a];if(!b)throw Error("Unknown field: "+a);return b}observe(a,
b,c){this.T(a).push([b,c])}unobserve(a,b,c){const d=this.T(a);this.C[a]=d.filter((a)=>!(a[0]===b&&(!c||a[1]==c)))}O(){var a=this.constructor[h],b;for(b in a){var c=a[b];this.C[b]=[];this.set(b,c.O())}}load(a){for(var b in a){var c=this.constructor[h][b];if(c)try{this.set(b,c.parse(a[b],b))}catch(d){throw console.error(`Error loading field ${b}: ${d}`),d;}else console.error("Unknown field: ",this.constructor.name,b)}}F(){var a=this.A,b=this.constructor[h],c={},d;for(d in a)c[d]=b[d].N(a[d]);return c}}
;class l extends Error{constructor(a){super(a);this.name="ValidationError";this.message=a;this.stack||(this.stack=Error(a).stack)}};function p(a,b,c){if(!c)throw new l(a+": "+b);};const r={min:function(a,b,c){p(c,`value ${b} isn't over ${a}`,b>=a)},max:function(a,b,c){p(c,`value ${b} isn't under ${a}`,b<=a)},ua:function(a,b,c){p(c,`value ${b} isn't an integer`,!a||0==b%1)},V:function(a,b,c){p(c,`value ${b} isn't in ${a}`,-1!==a.indexOf(b))},va:function(a,b,c){0==a&&p(c,"value can't be null or undefined",null!==b&&void 0!==b)}};
class t{constructor(a,b){var c=typeof a;p("type","Type is not a valid type: "+c,"string"==c||"function"==c);this.type=a;this.M=b||{}}J(a,b){this.U(a,b)}U(a,b){if(void 0===a)debugger;var c=this.type,d=typeof c,e=this.M;switch(d){case "string":p(b,"Value is not a "+c,typeof a===c);break;case "function":p(b,"Value is not a "+c.name,null===a||a instanceof c);break;default:throw Error("Unsupported type of type: "+d);}for(var g in e)if(g in r)r[g](e[g],a,b)}N(a){return"function"==typeof this.type?a?a.F():
null:a}parse(a,b){var c=this.type,d=typeof c;switch(d){case "string":return this.U(a,b),a;case "function":return a?c.fromJSON?c.fromJSON(a):new c(a):null;default:throw Error("Unknown value type: "+d);}}O(){var a=this.type,b=this.M;if(void 0!==b.default)return b.default;if(b.V)return b.V[0];if("string"==typeof a){b={number:0,string:"","boolean":!1};if(!(a in b))throw Error("Unknown type: "+a);return b[a]}return new a}};const u={qa:function(a,b,c){b=b.length;p(c,"Array length "+b+" is under "+a,b>=a)},pa:function(a,b,c){b=b.length;p(c,"Array length "+b+" is over "+a,b<=a)},count:function(a,b,c){this.qa(a,b,c);this.pa(a,b,c)}};
class v extends t{constructor(a,b){b||(b=[]);b.default||(b.default=[]);super(a,b)}J(a,b,c){if(void 0!==c)p(b,"Key must be an integer","number"==typeof c&&0===c%1),super.J(a,b+"["+c+"]");else{p(b,"Value must be an array",a instanceof Array);c=this.M;for(var d in c)if(d in u)u[d](c[d],a,b);d=0;for(c=a.length;d<c;d++)super.J(a[d],b+"["+d+"]")}}N(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=super.N(a[c]);return b}parse(a,b){var c=[];p(b,"value is not an array",a instanceof Array);for(var d=0,e=a.length;d<
e;d++)c[d]=super.parse(a[d],b);return c}};function w(a,b){if(a.hasOwnProperty(h))var c=a[h];else c=(a.wa||Object.getPrototypeOf(a.prototype)).constructor,c=Object.create(c[h]||{}),a[h]=c;a=c;for(var d in b)a[d]=b[d]}
function x(a,b){function c(a){return function(){return this.get(a)}}function d(a){return function(b){return this.set(a,b)}}if(!(a.prototype instanceof k))throw new TypeError("Not a Model: "+a.name);var e={},g={},q;for(q in b){var m=b[q],n=m[0];m=m[1];if(!n)throw new TypeError("Field name is missing");if(!m)throw new TypeError("Field definition is missing");e[n]=m;g[q]={enumerable:!0,configurable:!0,get:c(n),set:d(n)}}w(a,e);Object.defineProperties(a.prototype,g)}
function y(){return new t("string",void 0)};class z extends k{constructor(a){super(a)}}x(z,{s:["question",y()],u:["answer",y()],j:["incorrectAnswers",new v("string",void 0)],H:["notes",y()]});class A extends k{constructor(a){super(a)}}x(A,{g:["questions",new v(z,void 0)]});class B extends f{constructor(){super("div","locale-selector action select")}f(){const a={"en-us":"\ud83c\uddfa\ud83c\uddf8 US English",es:"\ud83c\uddea\ud83c\uddf8 Español"};return`<span aria-hidden="true">${a.es.split(" ")[0]}</span>\n            <select id="lang_selector" aria-hidden="false" aria-label="${"Idioma"}">${Object.keys(a).map((b)=>`<option value="${b}" ${"es"===b?"selected":""}>${a[b]}</option>`).join("")}\n            </select>`}i(){const a=this.a("select");a.addEventListener("change",
()=>{const b=a.value;b&&this.ca(b)})}ca(a){location.pathname=location.pathname.replace(/[^/]*$/,"en-us"===a?"":`index-${a}.html`)}};class C extends f{constructor(a){super("section","page homepage");this.b=a}f(){return`\n            <header>\n                <h2>${"Examen de práctica de Ria"}</h2>\n                <div class="actions"></div>\n            </header>\n            <main>\n                <p><a aria-role="button" class="button button-take-test${this.b.g.length?"":" disabled"}" href="#taketest/5">${"Tomar examen"}</a>\n                    ( <input type="number" class="num-questions" value="5"> ${"Preguntas"})</p>\n                <p><a aria-role="button" class="button" href="#edit">${"Editar banco de preguntas"}</a></p>\n            </main>\n        `}i(){const a=
this.a("input.num-questions"),b=this.a("a.button-take-test");a.addEventListener("input",()=>{b.href=`#taketest/${a.value}`});const c=this.a("header div.actions");this.v(new B,c)}};let D=1;function E(a){const b=[];for(let c=0,d=a.length;c<d;c++)b.splice(Math.floor(Math.random()*(c+1)),0,a[c]);return b};function F(a){return a.replace(/[&<>"']/g,function(a){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[a]})};class G extends f{constructor(a){super("section","page take-test");this.g=a;this.R=[]}f(){return`\n            <header><h2>${`Prueba de muestra: ${this.g.length} preguntas`}</h2></header>\n            <main class="test-questions"></main>\n            <footer>\n                <a class="button button-grade-test">${"Calificar la prueba"}</a>\n                <span class="test-results"></span>\n            </footer>\n        `}i(){this.R=[];const a=this.a("main.test-questions");let b=0;for(let c of this.g){const d=
new H(c,b++);this.v(d,a);this.R.push(d)}this.a("a.button.button-grade-test").addEventListener("click",this.la.bind(this))}la(){let a=0;const b=this.g.length;for(var c of this.R)a+=c.ka()?1:0;c=Math.round(100*a/b);this.a(".test-results").textContent=`${a} respuestas correctas de ${b} preguntas (${c}%)`}}
class H extends f{constructor(a,b){super("section","question");this.b=a;this.index=b}f(){const a=this.b,b=E(a.j.concat([a.u])),c=`question-${this.index}`;let d=0,e;return`\n            <h3 class="question ${c}">${this.index+1}. ${a.s}</h3>\n            <ol class="answers" type="A">\n                ${b.map((a)=>(e=`${c}-answer-${++d}`,`\n                        <li>\n                            <input type="radio" name="${c}" value="${F(a)}" id="${e}"\n                            ><label for="${e}">${F(a)}</label>\n                        </li>\n                    `)).join("")}\n            </ol>\n            <div class="notes" style="display: none">${F(a.H)}</div>\n        `}ka(){var a=
this.b;for(var b of this.querySelectorAll("li"))b.classList.remove("incorrect","correct");a=(b=this.a("input:checked"))&&b.value===a.u;b&&b.parentElement.classList.add(a?"correct":"incorrect");this.a(".notes").style.display=a?"none":"block";return a}};class I extends f{constructor(a){super("section","page edit-question");this.b=a;a=a.s;20<a.length&&(a=a.substr(17)+"…");this.title=`${"Editar pregunta"}: ${a}`;this.P=0;this.I=null}f(){return`\n            <header>\n                <h2>${"Editar pregunta"}</h2>\n            </header>\n            <main>\n                <div class="field textarea question">\n                    <label for="question-${D++}">${"Pregunta: "}</label>\n                    <textarea id="question-${D}"></textarea>\n                </div>\n                <div class="field text correct-answer">\n                    <label for="answer-${D++}">${"Respuesta: "}</label>\n                    <input id="answer-${D}" type="text">\n                </div>\n                <div class="incorrect-answers"></div>\n                <div class="field textarea notes">\n                    <label for="notes-${D++}">${"Notas: "}</label>\n                    <textarea id="notes-${D}"></textarea>\n                </div>\n                <div class="actions"><a class="button save">${"Completar"}</a></div>\n        </main>\n        `}i(){const a=
this.b,b=this.a(".question textarea"),c=this.a(".correct-answer input"),d=this.a(".button.save"),e=this.a(".notes textarea");a.j=a.j.filter(Boolean);b.value=a.s||"";c.value=a.u||"";e.value=a.H||"";b.addEventListener("input",()=>{a.s=b.value});c.addEventListener("input",()=>{a.u=c.value});e.addEventListener("input",()=>{a.H=e.value});d.addEventListener("click",()=>{this.I&&this.I.call(null)});this.ma=this.c.querySelector(".incorrect-answers");this.P=0;for(let b of a.j)this.L(b);this.L()}o(){const a=
this.b;a.j=a.j.filter(Boolean)}L(a=""){const b=this.b,c=document.createElement("div");c.className="field text incorrect-answer";c.innerHTML=`\n            <label for="answer-${D++}">${"Respuesta incorrecta: "}</label>\n            <input id="answer-${D}" type="text">\n        `;const d=this.P++,e=c.querySelector("input");a&&(e.value=a);e.addEventListener("input",()=>{(b.j[d]=e.value)&&d==this.P-1&&!b.j.some((a)=>!a)&&this.L()});this.ma.appendChild(c)}};class J extends f{constructor(a=""){super("div",`modal-dialog${a&&" "+a}`);this.onclose=null}$(a){return`<section>${a}</section>`}close(){this.onclose&&this.onclose.call(null)}};class K extends J{constructor(a){super();this.b=a;this.G=null}f(){return super.$('\n            <header>\n                <h3>Seleccionar archivo para importar:</h3>\n            </header>\n            <main>\n                <div><input type="file" name="import" accept=".json"></div>\n                <p><em>Esto reemplazará todas las preguntas abiertas con las del archivo.</em></p>\n                <div class="alert error hidden"></div>\n            </main>\n            <footer>\n                <a class="button cancel-button">Cancelar</a>\n                <a class="button load-button disabled">Importar</a>\n            </footer>\n        ')}i(){const a=
this.a("a.button.cancel-button"),b=this.a("input[type=file]"),c=this.a("a.button.load-button");a.addEventListener("click",this.close.bind(this));b.addEventListener("change",this.ja.bind(this),!1);c.addEventListener("click",()=>{this.G&&(this.b.set("questions",this.G.get("questions")),this.close())})}ja(a){a.preventDefault();a.stopPropagation();this.G=null;const b=a.target.files[0],c=this.a("div.alert.error"),d=this.a("a.button.load-button");d.classList.add("disabled");c.classList.add("hidden");c.textContent=
"";if(b){const a=new FileReader;a.onload=()=>{try{const b=JSON.parse(a.result),c=new A(b);c.g.length&&(this.G=c,d.classList.remove("disabled"))}catch(g){c.textContent=`No se pudo leer el archivo ${b.name}`,c.classList.remove("hidden")}};a.onerror=()=>{c.textContent="Ocurrió un error al abrir el archivo";c.classList.remove("hidden")};a.readAsText(b)}}};class L extends J{constructor(a){super();this.b=a}f(){return super.$('\n            <header>\n                <h3>Exportar preguntas</h3>\n            </header>\n            <main>\n                <div><label for="file_name_input">Nombre del archivo: </label><input type="text" id="file_name_input" value="Questions.json"></div>\n            </main>\n            <footer>\n                <a class="button cancel-button">Cancelar</a>\n                <a class="button save-button disabled">Guardar</a>\n            </footer>\n        ')}i(){function a(){const a=
c.value;d.setAttribute("download",a);d.classList.toggle("disabled",!a)}var b=this.a("a.button.cancel-button");const c=this.a("input#file_name_input"),d=this.a("a.button.save-button");b.addEventListener("click",this.close.bind(this));b=JSON.stringify(this.b.F(),null,2);d.href="data:text/plain;charset=utf-8,"+encodeURIComponent(b);d.classList.remove("disabled");a();c.addEventListener("input",a);d.addEventListener("click",()=>{setTimeout(()=>{this.close()},25)})}};class M extends f{constructor(a){super("section","page edit-test-bank responsive-toolbar");this.b=a;this.Y=0;this.title="Todas las preguntas"}f(){return'\n            <header class="toolbar">\n                <h2>Todas las preguntas</h2>\n                <div class="actions">\n                    <a class="action add-action" href="#edit/new" title="Nueva pregunta" data-short-title="Nueva"></a>\n                    <a class="action save-action disabled" download="Questions.json" title="Guardar archivo" data-short-title="Guardar"></a>\n                    <a class="action load-action" title="Abrir archivo" data-short-title="Abrir"></a>\n                    <a class="action" href="#" title="Completar"></a>\n                </div>\n            </header>\n            <main>\n                <table class="edit-questions">\n                    <thead>\n                        <th class="number"></th>\n                        <th class="question">Pregunta</th>\n                        <th class="answer">Respuesta</th>\n                        <th class="incorrect-answers">Respuestas incorrectas</th>\n                        <th class="notes">Notas</th>\n                    </thead>\n                    <tbody></tbody>\n                </table>\n            </main>\n        '}i(){this.B();
this.Y=0;this.a(".actions a.add-action");const a=this.a("table.edit-questions > tbody"),b=this.a(".actions a.save-action"),c=this.a(".actions a.load-action"),d=this.b;for(let b of d.g){const c=new N(b,this.Y++);this.v(c,a)}JSON.stringify(d.F(),null,2);b.classList.toggle("disabled",!d.g.length);b.addEventListener("click",this.sa.bind(this));c.addEventListener("click",this.na.bind(this));d.observe("questions",this,()=>{this.refresh()})}o(){this.B()}B(){this.b.unobserve("questions",this)}sa(){const a=
new L(this.b);this.v(a);a.onclose=()=>{this.Z(a)}}na(){const a=new K(this.b);this.v(a);a.onclose=()=>{this.Z(a)}}}
class N extends f{constructor(a,b){super("tr","question");this.b=a;this.index=b}f(){return`\n            <th class="number">${this.index+1}</th>\n            <td class="question"></td>\n            <td class="answer" title="${"Respuesta: "}"></td>\n            <td class="incorrect-answers" title="${"Respuestas incorrectas: "}"></td>\n            <td class="notes" title="${"Notas: "}"></td>\n        `}i(){const a=this.b;this.B();this.c.addEventListener("click",()=>{location.hash=`#edit/${this.index+
1}`});const b=this.a("td.question"),c=this.a("td.answer"),d=this.a("td.incorrect-answers"),e=this.a("td.notes"),g=(a)=>{d.innerHTML="";for(let b=0,c=a.length;b<c;b++){const e=document.createElement("div");e.textContent=a[b];b<c-1&&(e.textContent+=",");d.appendChild(e)}};b.textContent=a.s;c.textContent=a.u;g(a.j);e.textContent=a.H;a.observe("question",this,(a)=>{b.textContent=a});a.observe("answer",this,(a)=>{c.textContent=a});a.observe("incorrectAnswers",this,g);a.observe("notes",this,(a)=>{e.textContent=
a})}o(){this.B()}B(){const a=this.b;a.unobserve("question",this);a.unobserve("answer",this);a.unobserve("incorrectAnswers",this)}};class O{constructor(a){this.aa=a;this.K=()=>{this.ha()}}start(){window.addEventListener("hashchange",this.K);this.K()}stop(){window.removeEventListener("hashchange",this.K)}ha(){var a=location.hash.substr(1);let b;for(let c of this.aa)if(b=c.pattern.exec(a)){c.l.apply(null,b);return}console.error("Unable to find handler for route "+a,this.aa)}};const P={questions:[{question:"What is the meaning of Life, the Universe, and Everything?",answer:"Nobody knows because the Earth was blown up",incorrectAnswers:["42","Vogon poetry","Don’t panic"],notes:"42 is the answer to the question of the meaning of Life, the Universe, and Everything. But without the question – which nobody knows – it's meaningless."}]};class Q extends f{constructor(){super("div","app");this.h=this.D=null;this.ra=new O([{pattern:/^$/,l:this.fa.bind(this)},{pattern:/^taketest$/,l:this.X.bind(this)},{pattern:/^taketest\/(\d+)$/,l:this.X.bind(this)},{pattern:/^edit$/,l:this.da.bind(this)},{pattern:/^edit\/(\d+)$/,l:this.ea.bind(this)},{pattern:/^edit\/new$/,l:this.ga.bind(this)},{pattern:/.*/,l:this.W.bind(this)}])}ta(){this.oa();this.display(document.body);this.ra.start()}f(){return""}w(a,b){this.D&&(this.D.remove(),this.D=null);a=
new a(b);a.display(this.c);this.D=a;document.title=a.title||"Examen de práctica";return a}fa(){this.w(C,this.h)}X(a,b){b=parseInt(b,10)||5;a=E(this.h.g).slice(0,b);this.w(G,a)}da(){this.w(M,this.h)}S(){localStorage.setItem("questionStore",JSON.stringify(this.h.F()))}oa(){this.h&&this.h.unobserve("questions",this);const a=new A,b=localStorage.getItem("questionStore")||JSON.stringify(P);if(b)try{a.load(JSON.parse(b))}catch(c){console.error("Unable to parse save data: ",c)}a.observe("questions",this,
()=>{console.log("Application: observed update to questions field");this.S()});this.h=a}ea(a,b){(b=this.h.g[parseInt(b,10)-1])?this.w(I,b).I=()=>{this.S();location.hash="#edit"}:this.W(a)}ga(){const a=new z;this.w(I,a).I=()=>{a.s&&this.h.append("questions",a);this.S();location.hash="#edit"}}W(a){console.log("Will display 404: ",a)}};(new Q).ta();}).call(this)
